# Продуктовый помощник - Foodgram

![example workflow](https://github.com/TutunkinVladislav/foodgram-project-react/actions/workflows/foodgram_workflow.yml/badge.svg)

На этом сервисе пользователи смогут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд. В проекте доступна система регистрации и авторизации пользователей.

## Описание проекта:
### Главная страница
На странице - cписок первых шести рецептов, отсортированных по дате публикации
(от новых к старым). Остальные рецепты доступны на следующих страницах: внизу
страницы есть пагинация.

### Страница рецепта
На странице - полное описание рецепта. Для авторизованных пользователей -
возможность добавить рецепт в избранное и в список покупок, возможность
подписаться на автора рецепта.

### Страница пользователя
На странице - имя пользователя, все рецепты, опубликованные пользователем и
возможность подписаться на пользователя.

### Подписка на авторов
Подписка на публикации доступна только авторизованному пользователю. Страница
подписок доступна только владельцу.

Сценарий поведения пользователя:
1. Пользователь переходит на страницу другого пользователя или на страницу 
   рецепта и подписывается на публикации автора кликом по кнопке «Подписаться
   на автора».
2. Пользователь переходит на страницу «Мои подписки» и просматривает
   список рецептов, опубликованных теми авторами, на которых он подписался.
   Сортировка записей - по дате публикации (от новых к старым). 
3. При необходимости пользователь может отказаться от подписки на автора:
   переходит на страницу автора или на страницу его рецепта и нажимает
   «Отписаться от автора».

### Список избранного
Список избранного может просматривать только его владелец. Сценарий поведения пользователя:
1. Пользователь отмечает один или несколько рецептов кликом по кнопке
   «Добавить в избранное».
2. Переходит на страницу «Список избранного» и просматривает
   персональный список избранных рецептов. При необходимости пользователь может 
   удалить рецепт из избранного.

### Список покупок
Список покупок может просматривать только его владелец.
Сценарий поведения пользователя:
1. Пользователь отмечает один или несколько рецептов кликом по кнопке
   «Добавить в покупки».
2. Пользователь переходит на страницу Список покупок, там доступны все
   добавленные в список рецепты. Пользователь нажимает кнопку «Скачать список»
   и получает файл с суммированным перечнем и количеством необходимых
   ингредиентов для всех рецептов, сохранённых в «Списке покупок».
3. При необходимости пользователь может удалить рецепт из списка покупок.

Список покупок скачивается в формате txt. При скачивании списка покупок
ингредиенты в результирующем списке не дублируются;
если в двух рецептах есть сахар (в одном рецепте - 5 г, в другом - 10 г),
то в списке будет один пункт: Сахар - 15 г.
В результате список покупок выглядит так:
* Фарш (баранина и говядина) - 600 г
* Сыр плавленый - 200 г
* Лук репчатый - 50 г

### Фильтрация по тегам
При нажатии на название тега выводится список рецептов, отмеченных этим тегом.
Фильтрация может проводится по нескольким тегам. При фильтрации на странице
пользователя фильтруются только рецепты выбранного пользователя. Такой же
принцип соблюдается при фильтрации списка избранного.

### Стек:
- Python 3.9
- Django 3.2
- Gunicorn 20.1.0
- Nginx 1.21.3
- Postgres 13.0
- Docker 24.0.2
- DRF 3.14.0
- Djoser 2.2.0

### Шаблон наполнения env-файла
```
DB_NAME='postgres' # имя базы данных
POSTGRES_USER='postgres' # логин для подключения к базе данных
POSTGRES_PASSWORD='postgres' # пароль для подключения к БД
DB_HOST='db' # название сервиса (контейнера)
DB_PORT='5432' # порт для подключения к БД
DEBUG='False' # отключение вывода ошибок
```

### Запуск проекта

Клонируем репозиторий и создаём файл `.env`.

#### Настройка workflow
Для использования Continuous Integration (CI) и Continuous Deployment (CD): в
репозитории GitHub нужно перейти `Settings/Secrets and variables/Actions` прописать Secrets -
переменные окружения для доступа к сервисам:
```
DB_ENGINE - django.db.backends.postgresql
DB_NAME - postgres (имя БД)
POSTGRES_USER - postgres (логин для подключения к БД)
POSTGRES_PASSWORD - (пароль для подключения к БД)
DB_HOST - db (название контейнера)
DB_PORT - 5432 (порт для подключения к БД)
HOST - (имя или IP хоста/домена)
DEBUG - False
DOCKER_USERNAME - (имя пользователя в DockerHub)
DOCKER_PASSWORD  - (пароль пользователя в DockerHub)
USER - (имя пользователя "Виртуальной машины" в Yandex Cloud)
SSH_KEY - (приватный ssh-ключ "cat ~/.ssh/id_rsa")
PASSPHRASE - (пароль для ssh-ключа)
TELEGRAM_TO - (id аккаунт в Telegram)
TELEGRAM_TOKEN  - (токен бота)
```
При push в ветку main автоматически отрабатывают сценарии:
* *tests* - проверка кода на соответствие стандарту PEP8 и запуск pytest.
* *backend_build_and_push_to_docker_hub* - сборка backend и доставка докер-образа на DockerHub
* *frontend_build_and_push_to_docker_hub* - сборка frontend и доставка докер-образа на DockerHub
* *deploy* - автоматический деплой проекта на боевой сервер. Выполняется
копирование файлов из DockerHub на сервер;
* *send_message* - отправка уведомления в Telegram.

#### Подготовка удалённого сервера
* Войти на удалённый сервер:
```
ssh <username>@<ip_address>
```
* Остановить службу ```nginx```:
```
sudo systemctl stop nginx
```
* Установить Docker и Docker-compose:
```
sudo apt update
sudo apt upgrade -y
sudo apt install docker.io
sudo apt install docker-compose -y
```
* Проверить корректность установки Docker-compose:
```
sudo docker-compose --version
```
* На сервере создать директорию `nginx`:
```
mkdir nginx
```
* Скопировать файлы `docker-compose.yaml` и
```nginx/default.conf``` из проекта (локально) на сервер в
```home/<username>/docker-compose.yaml``` и
```home/<username>/nginx/default.conf``` соответственно:
  * перейти в директорию с файлом ```docker-compose.yaml``` и выполните:
  ```
  scp docker-compose.yaml <username>@<ip_address>:/home/<username>/
  ```
  * перейти в директорию с файлом ```default.conf``` и выполните:
  ```
  scp default.conf <username>@<ip_address>:/home/<username>/nginx/
  ```

#### После успешного деплоя
* Создать суперпользователя:
```
docker-compose exec web python manage.py createsuperuser
```
* Для проверки работоспособности приложения, перейти на страницу:
```
http:/158.160.73.62
```
#### Доступ к админке:
```
http:/158.160.73.62/admin
Логин: admin1
Пароль: admin1
```

### Автор проекта:
[Владислав Тутункин](https://github.com/TutunkinVladislav)